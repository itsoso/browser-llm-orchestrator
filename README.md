# Browser LLM Orchestrator

> **å¤š LLM ç¼–æ’å†³ç­–ç³»ç»Ÿ** â€” é€šè¿‡æµè§ˆå™¨è‡ªåŠ¨åŒ–å¹¶è¡Œè°ƒç”¨å¤šä¸ªå¤§è¯­è¨€æ¨¡å‹ï¼Œäº¤å‰éªŒè¯åç”±ä»²è£è€…æ¨¡å‹ç»¼åˆå‡ºå¯ä¿¡ç»“è®ºã€‚

---

## ğŸ¯ é¡¹ç›®ç®€ä»‹

**Browser LLM Orchestrator** æ˜¯ä¸€ä¸ªåˆ›æ–°çš„å¤šæ¨¡å‹ç¼–æ’æ¡†æ¶ï¼Œæ ¸å¿ƒç†å¿µæ˜¯ï¼š**ä¸ä¾èµ–å•ä¸€ AI æ¨¡å‹çš„åˆ¤æ–­ï¼Œè€Œæ˜¯è®©å¤šä¸ªé¡¶çº§ LLM å„æŠ’å·±è§ï¼Œå†ç”±ä»²è£è€…æ¨¡å‹åšå‡ºæœ€ç»ˆè£å†³**ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦å¤š LLM å†³ç­–ï¼Ÿ

1. **å‡å°‘å¹»è§‰é£é™©**ï¼šå•ä¸€æ¨¡å‹å¯èƒ½äº§ç”Ÿ"è‡ªä¿¡çš„é”™è¯¯"ï¼Œå¤šæ¨¡å‹äº¤å‰éªŒè¯èƒ½æ˜¾è‘—é™ä½å¹»è§‰æ¦‚ç‡
2. **é¿å…æ¨¡å‹åè§**ï¼šä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„è®­ç»ƒæ•°æ®å’Œæ¨ç†é£æ ¼ï¼Œç»¼åˆå¤šæ–¹è§‚ç‚¹æ›´å…¨é¢
3. **æå‡å¯ä¿¡åº¦**ï¼šå½“å¤šä¸ªæ¨¡å‹å¾—å‡ºç›¸åŒç»“è®ºæ—¶ï¼Œè¯¥ç»“è®ºçš„å¯ä¿¡åº¦æ›´é«˜
4. **å……åˆ†åˆ©ç”¨èµ„æº**ï¼šåŒæ—¶è°ƒç”¨å¤šä¸ªå·²è®¢é˜…è´¦å·çš„ LLMï¼Œæœ€å¤§åŒ–åˆ©ç”¨å…è´¹/ä»˜è´¹é¢åº¦

### æ”¯æŒçš„ LLM å¹³å°

| å¹³å° | çŠ¶æ€ | è¯´æ˜ |
|:---|:---:|:---|
| **ChatGPT** | âœ… | æ”¯æŒæ¨¡å‹ç‰ˆæœ¬åˆ‡æ¢ï¼ˆ5.2 Pro / 5.2 Instant / Thinkingï¼‰ |
| **Gemini** | âœ… | Google AI å¹³å° |
| **Perplexity** | âœ… | æœç´¢å¢å¼ºå‹ AI |
| **Grok** | âœ… | X/Twitter AI |
| **åƒé—® (Qianwen)** | âœ… | é˜¿é‡Œé€šä¹‰åƒé—® |

---

## ğŸ§  è®¾è®¡ç†å¿µ

### 1. å¤šæ¨¡å‹å¹¶è¡ŒæŸ¥è¯¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    User Prompt                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼               â–¼               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ ChatGPT â”‚    â”‚  Gemini â”‚    â”‚  Grok   â”‚  ...
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚               â”‚               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Arbitrator Model    â”‚
              â”‚  (ç»¼åˆ + ä»²è£ + è£å†³)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Final Decision      â”‚
              â”‚  (Markdown â†’ Obsidian) â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä»²è£æœºåˆ¶

ç³»ç»Ÿä¸åšç®€å•çš„"å¹³å‡ä¸»ä¹‰"ï¼Œè€Œæ˜¯ç”±æŒ‡å®šçš„ä»²è£è€…æ¨¡å‹ï¼ˆé»˜è®¤ Geminiï¼‰æ‰§è¡Œä¸¥æ ¼çš„ç»¼åˆåˆ†æï¼š

- **å…±è¯†è¯†åˆ«**ï¼šæ‰¾å‡ºå¤šæ¨¡å‹ä¸€è‡´åŒæ„çš„ç»“è®º
- **åˆ†æ­§è£å†³**ï¼šå¯¹ä¸åŒæ„è§è¿›è¡Œè¯„åˆ¤ï¼Œç»™å‡ºç†ç”±
- **ç½®ä¿¡åº¦è¯„ä¼°**ï¼šä¸ºæ¯ä¸ªç»“è®ºæ ‡æ³¨ Low/Med/High ç½®ä¿¡åº¦
- **éªŒè¯è·¯å¾„**ï¼šå¯¹ä¸ç¡®å®šå†…å®¹æ ‡æ³¨ã€éœ€æ ¸éªŒã€‘å¹¶ç»™å‡ºéªŒè¯æ–¹æ³•

### 3. æµè§ˆå™¨è‡ªåŠ¨åŒ–

ä½¿ç”¨ Playwright æ§åˆ¶çœŸå®æµè§ˆå™¨ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **ç»•è¿‡ API é™åˆ¶**ï¼šç›´æ¥ä½¿ç”¨ç½‘é¡µç‰ˆï¼Œæ— éœ€ç”³è¯· API key
- **åˆ©ç”¨å·²ç™»å½•ä¼šè¯**ï¼šä½¿ç”¨æœ¬åœ° Chrome Profileï¼Œä¿æŒç™»å½•çŠ¶æ€
- **Stealth æ¨¡å¼**ï¼šé™ä½åçˆ¬è™«æ£€æµ‹ï¼ˆCloudflare ç­‰ï¼‰çš„è§¦å‘ç‡
- **å¯è§†åŒ–è°ƒè¯•**ï¼šæ”¯æŒæœ‰å¤´æ¨¡å¼ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

### 4. Obsidian åŸç”Ÿé›†æˆ

æ‰€æœ‰è¾“å‡ºç›´æ¥å†™å…¥ Obsidian Vaultï¼š

- æ ‡å‡† Markdown æ ¼å¼ï¼Œæ”¯æŒ frontmatter å…ƒæ•°æ®
- è‡ªåŠ¨ç”Ÿæˆè¿è¡Œç´¢å¼•å’Œç›®å½•ç»“æ„
- æ”¯æŒè¡¨æ ¼ã€åˆ—è¡¨ã€å¼•ç”¨ç­‰å¯Œæ–‡æœ¬æ ¼å¼

---

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

- **ç ”ç©¶è°ƒç ”**ï¼šå¤šè§’åº¦æ”¶é›†ä¿¡æ¯ï¼Œäº¤å‰éªŒè¯äº‹å®
- **å†³ç­–æ”¯æŒ**ï¼šé‡è¦å†³ç­–å‰è·å–å¤šæ¨¡å‹å»ºè®®
- **çŸ¥è¯†æ•´ç†**ï¼šè‡ªåŠ¨åŒ–ç”Ÿæˆç ”ç©¶ç¬”è®°åˆ° Obsidian
- **æ‰¹é‡åˆ†æ**ï¼šå‘¨æŠ¥/æœˆæŠ¥/è¶‹åŠ¿åˆ†æçš„è‡ªåŠ¨åŒ–ç”Ÿæˆ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
source .venv/bin/activate
```

## Install
```bash
pip install -r requirements.txt
```

## é¢„çƒ­è´¦å·ï¼ˆé¦–æ¬¡ä½¿ç”¨æˆ–ç™»å½•å¤±æ•ˆæ—¶ï¼‰

å¦‚æœé‡åˆ° `ensure_ready: still cannot locate textbox after manual checkpoint` é”™è¯¯ï¼Œè¯´æ˜éœ€è¦æ‰‹åŠ¨ç™»å½•å¹¶ä¿å­˜æµè§ˆå™¨çŠ¶æ€ã€‚

### ä½¿ç”¨é¢„çƒ­è„šæœ¬

```bash
# é¢„çƒ­å•ä¸ªç«™ç‚¹
python warmup.py chatgpt    # é¢„çƒ­ ChatGPT
python warmup.py gemini      # é¢„çƒ­ Gemini
python warmup.py perplexity  # é¢„çƒ­ Perplexity

# æˆ–é¢„çƒ­æ‰€æœ‰ç«™ç‚¹
python warmup.py all
```

**æ“ä½œæ­¥éª¤ï¼š**
1. è„šæœ¬ä¼šæ‰“å¼€æµè§ˆå™¨çª—å£
2. æ‰‹åŠ¨å®Œæˆç™»å½•å’ŒéªŒè¯ï¼ˆå¦‚ Cloudflare éªŒè¯ï¼‰
3. ç¡®ä¿èƒ½çœ‹åˆ°èŠå¤©è¾“å…¥æ¡†
4. å›åˆ°ç»ˆç«¯æŒ‰å›è½¦ä¿å­˜çŠ¶æ€

**æ³¨æ„äº‹é¡¹ï¼š**
- é¢„çƒ­è„šæœ¬ä½¿ç”¨ä¸ RPA ç›¸åŒçš„é…ç½®ï¼Œç¡®ä¿çŠ¶æ€å…¼å®¹
- å¦‚æœçœ‹åˆ° "stealth mode not available" è­¦å‘Šï¼Œè¿è¡Œ `pip install playwright-stealth`
- çŠ¶æ€ä¿å­˜åœ¨ `profiles/<site_id>/` ç›®å½•ä¸‹

## é…ç½®

ç¼–è¾‘ `brief.yaml` æ–‡ä»¶ï¼Œé…ç½® driver_server å‚æ•°ï¼š

```yaml
driver_server:
  sites: "chatgpt,gemini,perplexity,grok,qianwen"
  port: 27125
  profiles_root: "profiles"
  artifacts_root: "runs/driver/artifacts"
  host: "127.0.0.1"
  headless: false
  prewarm: true
```

## å¯åŠ¨ Driver Server

### æ–¹å¼1ï¼šä» brief.yaml è¯»å–é…ç½®ï¼ˆæ¨èï¼‰
```bash
# å¯åŠ¨å‰æ£€æŸ¥é¢„çƒ­çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
PYTHONUNBUFFERED=1 python -u start_driver.py --brief ./brief.yaml --check-warmup

# æ­£å¸¸å¯åŠ¨
PYTHONUNBUFFERED=1 python -u start_driver.py --brief ./brief.yaml
```

### æ–¹å¼2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°ï¼ˆè¦†ç›–é…ç½®ï¼‰
```bash
PYTHONUNBUFFERED=1 python -u -m rpa_llm.driver_server --sites chatgpt,gemini,perplexity,grok,qianwen --port 27125 --profiles-root profiles
```

### å¯åŠ¨å¤±è´¥æ—¶çš„å¤„ç†

å¦‚æœå¯åŠ¨æ—¶çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹é”™è¯¯ï¼š
```
âš ï¸  chatgpt åˆå§‹åŒ–å¤±è´¥ï¼šéœ€è¦ç™»å½•æˆ–éªŒè¯
é”™è¯¯: ensure_ready: still cannot locate textbox after manual checkpoint
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. è¿è¡Œé¢„çƒ­è„šæœ¬æ‰‹åŠ¨ç™»å½•ï¼š
   ```bash
   python warmup.py chatgpt
   ```
2. é‡æ–°å¯åŠ¨ driver server
3. å¦‚æœé—®é¢˜æŒç»­ï¼Œæ£€æŸ¥ï¼š
   - æ˜¯å¦å®‰è£…äº† `playwright-stealth`: `pip install playwright-stealth`
   - æŸ¥çœ‹æˆªå›¾: `runs/driver/artifacts/<site_id>/`

## ä½¿ç”¨

### åŸºæœ¬ç”¨æ³•

```bash
export RPA_DRIVER_URL="http://127.0.0.1:27125"
PYTHONUNBUFFERED=1 python -u -m rpa_llm.cli --brief ./brief.yaml
```

æˆ–è€…ç›´æ¥åœ¨ brief.yaml ä¸­é…ç½® `driver_url`ï¼Œæ— éœ€è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

### é«˜çº§åŠŸèƒ½

#### 1. æŒ‡å®š ChatGPT æ¨¡å‹ç‰ˆæœ¬

ä½¿ç”¨ `--model-version` å‚æ•°å¯ä»¥è¦†ç›– `brief.yaml` ä¸­çš„æ¨¡å‹ç‰ˆæœ¬é…ç½®ï¼š

```bash
# ä½¿ç”¨ ChatGPT 5.2 Pro
python -m rpa_llm.cli --brief ./brief.yaml --model-version 5.2pro

# ä½¿ç”¨ ChatGPT 5.2 Instant
python -m rpa_llm.cli --brief ./brief.yaml --model-version 5.2instant

# ä½¿ç”¨ Thinking æ¨¡å¼
python -m rpa_llm.cli --brief ./brief.yaml --model-version thinking
```

**æ”¯æŒçš„æ¨¡å‹ç‰ˆæœ¬ï¼š**
- `5.2pro` - ChatGPT 5.2 Proï¼ˆç ”ç©¶çº§æ™ºèƒ½æ¨¡å‹ï¼‰
- `5.2instant` - ChatGPT 5.2 Instantï¼ˆå¿«é€Ÿå“åº”ï¼‰
- `thinking` - Thinking æ¨¡å¼ï¼ˆæ·±åº¦æ€è€ƒï¼‰

**æ³¨æ„ï¼š**
- å¦‚æœ `brief.yaml` ä¸­é…ç½®äº† `output.site_model_versions`ï¼ŒCLI å‚æ•°ä¼šè¦†ç›– ChatGPT ç«™ç‚¹çš„é…ç½®
- å…¶ä»–ç«™ç‚¹ï¼ˆå¦‚ Geminiï¼‰çš„æ¨¡å‹ç‰ˆæœ¬ä»ä½¿ç”¨ `brief.yaml` ä¸­çš„é…ç½®

#### 2. ä½¿ç”¨è‡ªå®šä¹‰ Prompt æ–‡ä»¶

ä½¿ç”¨ `--prompt-file` å‚æ•°å¯ä»¥ä»æ–‡ä»¶è¯»å– promptï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `brief.yaml` ä¸­çš„ `prompt_template`ï¼š

```bash
# ä½¿ç”¨ Obsidian æ–‡ä»¶ä½œä¸º prompt
python -m rpa_llm.cli --brief ./brief.yaml --prompt-file "/path/to/obsidian/note.md"

# ä½¿ç”¨æœ¬åœ° Markdown æ–‡ä»¶
python -m rpa_llm.cli --brief ./brief.yaml --prompt-file "./my_prompt.md"
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- ä» Obsidian ç¬”è®°ä¸­ç›´æ¥å¤åˆ¶ prompt è¿›è¡Œåˆ†æ
- ä½¿ç”¨å¤æ‚çš„å¤šæ®µè½ promptï¼Œä¸é€‚åˆæ”¾åœ¨ YAML ä¸­
- å¤ç”¨å·²æœ‰çš„ prompt æ–‡ä»¶

**æ³¨æ„äº‹é¡¹ï¼š**
- æ–‡ä»¶è·¯å¾„æ”¯æŒç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„
- æ–‡ä»¶å¿…é¡»æ˜¯ UTF-8 ç¼–ç 
- å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œç¨‹åºä¼šæŠ¥é”™å¹¶é€€å‡º
- ä½¿ç”¨è‡ªå®šä¹‰ prompt æ–‡ä»¶æ—¶ï¼Œ`brief.yaml` ä¸­çš„ `prompt_template` ä¼šè¢«å¿½ç•¥

#### 3. ç»„åˆä½¿ç”¨

å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªå‚æ•°ï¼š

```bash
# ä½¿ç”¨è‡ªå®šä¹‰ prompt æ–‡ä»¶ + æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬
python -m rpa_llm.cli \
  --brief ./brief.yaml \
  --prompt-file "/path/to/prompt.md" \
  --model-version 5.2pro \
  --run-id "custom_run_001"
```

### å®Œæ•´å‚æ•°åˆ—è¡¨

```bash
python -m rpa_llm.cli --help
```

**ä¸»è¦å‚æ•°ï¼š**
- `--brief` (å¿…éœ€): Brief YAML æ–‡ä»¶è·¯å¾„
- `--run-id`: è¿è¡Œ IDï¼ˆé»˜è®¤ï¼šUTC æ—¶é—´æˆ³ï¼‰
- `--headless`: æ— å¤´æ¨¡å¼ï¼ˆä¸æ¨èç”¨äº LLM ç«™ç‚¹ï¼‰
- `--log-file`: æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šè‡ªåŠ¨ç”Ÿæˆåˆ° `logs/` ç›®å½•ï¼‰
- `--model-version`: æŒ‡å®š ChatGPT æ¨¡å‹ç‰ˆæœ¬ï¼ˆè¦†ç›– brief.yaml é…ç½®ï¼‰
- `--prompt-file`: è‡ªå®šä¹‰ prompt æ–‡ä»¶è·¯å¾„ï¼ˆè¦†ç›– brief.yaml ä¸­çš„ prompt_templateï¼‰

---

## ğŸ’¬ Chatlog é›†æˆï¼šå¾®ä¿¡ç¾¤èŠè‡ªåŠ¨åŒ–åˆ†æ

### æ¦‚è¿°

æœ¬é¡¹ç›®é›†æˆäº† [Chatlog](https://github.com/nicethings/chatlog) æœåŠ¡ï¼Œå®ç°äº†**å¾®ä¿¡ç¾¤èŠè®°å½•è‡ªåŠ¨åŒ–åˆ†æ**çš„å®Œæ•´å·¥ä½œæµï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Chatlog è‡ªåŠ¨åŒ–æµç¨‹                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚                               â”‚
    â–¼                               â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Chatlog â”‚  â”€â”€â”€â”€ HTTP â”€â”€â”€â”€>  â”‚  æœ¬é¡¹ç›®  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>   â”‚  Obsidian   â”‚
â”‚ æœåŠ¡    â”‚    è·å–ç¾¤èŠè®°å½•     â”‚ è‡ªåŠ¨åŒ–   â”‚   ä¿å­˜åˆ†æç»“æœ    â”‚   Vault     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                             â”‚
                     â–¼                             â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Raw æ–‡ä»¶    â”‚              â”‚ Summary æ–‡ä»¶ â”‚
              â”‚ (åŸå§‹è®°å½•)   â”‚              â”‚ (LLM åˆ†æ)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾è®¡ç†å¿µ

1. **æœ¬åœ°åŒ–æ•°æ®é—­ç¯**ï¼šèŠå¤©è®°å½• â†’ LLM åˆ†æ â†’ Obsidian å­˜å‚¨ï¼Œå…¨ç¨‹æœ¬åœ°è¿è¡Œ
2. **æ„å»ºä¸ªäººçŸ¥è¯†åº“**ï¼šåˆ†æç»“æœç›´æ¥è½åœ° Obsidianï¼Œä¾¿äºåç»­æ£€ç´¢å’Œ embedding
3. **è‡ªåŠ¨åŒ–å‘¨æœŸå¤„ç†**ï¼šæ”¯æŒæŒ‰å‘¨æ‰¹é‡åˆ†æï¼Œé€‚åˆå‘¨æŠ¥/å¤ç›˜åœºæ™¯
4. **æ¨¡æ¿é©±åŠ¨**ï¼šæ”¯æŒè‡ªå®šä¹‰åˆ†ææ¨¡æ¿ï¼Œé€‚åº”ä¸åŒç¾¤èŠç±»å‹

### å·¥ä½œæµç¨‹

#### 1. è·å–èŠå¤©è®°å½•

é€šè¿‡ Chatlog HTTP API è·å–æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„ç¾¤èŠè®°å½•ï¼š

```bash
# Chatlog API ç¤ºä¾‹
curl "http://127.0.0.1:5030/api/v1/chatlog?time=2026-01-01~2026-01-07&talker=å·ç¾¤-2025&format=json"
```

#### 2. ä¿å­˜ Raw æ–‡ä»¶

åŸå§‹èŠå¤©è®°å½•ä¿å­˜åˆ° Obsidianï¼Œä¾¿äºæº¯æºï¼š

```
10_Sources/WeChat/
â””â”€â”€ 00-raws/
    â””â”€â”€ å·ç¾¤-2025/
        â””â”€â”€ 2026/
            â””â”€â”€ 01/
                â””â”€â”€ ç¬¬1å‘¨/
                    â””â”€â”€ å·ç¾¤-2025 2026-01-01~2026-01-07-raw.md
```

#### 3. LLM åˆ†æ

ä½¿ç”¨æœ¬é¡¹ç›®çš„å¤šæ¨¡å‹èƒ½åŠ›åˆ†æèŠå¤©å†…å®¹ï¼š
- æ”¯æŒè‡ªå®šä¹‰åˆ†ææ¨¡æ¿ï¼ˆè§ `templates/chatlog_for_wechat.md`ï¼‰
- æ”¯æŒæŒ‡å®šæ¨¡å‹ç‰ˆæœ¬ï¼ˆå¦‚ ChatGPT 5.2 Proï¼‰
- è¾“å‡ºç»“æ„åŒ–çš„å¤ç›˜æŠ¥å‘Š

#### 4. ä¿å­˜ Summary æ–‡ä»¶

åˆ†æç»“æœä¿å­˜åˆ° Obsidianï¼Œå½¢æˆçŸ¥è¯†æ²‰æ·€ï¼š

```
10_Sources/WeChat/
â””â”€â”€ 10-Summaries/
    â””â”€â”€ å·ç¾¤-2025/
        â””â”€â”€ 2026/
            â””â”€â”€ 01/
                â””â”€â”€ ç¬¬1å‘¨/
                    â””â”€â”€ å·ç¾¤-2025 ç¬¬1å‘¨-2026-01-01~2026-01-07-Sum-5.2pro.md
```

### å¿«é€Ÿä½¿ç”¨

#### é…ç½®æ–‡ä»¶

åˆ›å»º `chatlog_automation.yaml`ï¼š

```yaml
# Chatlog æœåŠ¡é…ç½®
chatlog:
  url: "http://127.0.0.1:5030"

# LLM åˆ†æé…ç½®
llm:
  arbitrator_site: "chatgpt"  # å¯é€‰: chatgpt, gemini
  model_version: "5.2pro"     # æ¨¡å‹ç‰ˆæœ¬
  task_timeout_s: 1200        # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  new_chat: true              # æ¯æ¬¡æ‰“å¼€æ–°çª—å£

# Obsidian è·¯å¾„é…ç½®
obsidian:
  base_path: "~/work/personal/obsidian/personal/10_Sources/WeChat"
  template: "./templates/chatlog_for_wechat.md"  # åˆ†ææ¨¡æ¿
```

#### å•æ¬¡è¿è¡Œ

```bash
# åˆ†ææŒ‡å®šæ—¥æœŸèŒƒå›´çš„ç¾¤èŠ
python -m rpa_llm.chatlog_automation \
  --talker "å·ç¾¤-2025" \
  --start 2026-01-01 \
  --end 2026-01-07 \
  --config ./chatlog_automation.yaml
```

#### æ‰¹é‡å‘¨åˆ†æ

```bash
# æ‰¹é‡å¤„ç†å¤šå‘¨æ•°æ®
python rpa_llm/batch_weekly_analysis.py \
  --talker "å·ç¾¤-2025" \
  --year 2025 \
  --start-week 48 \
  --end-week 53 \
  --config ./chatlog_automation.yaml
```

### è¾“å‡ºç¤ºä¾‹

åˆ†æç»“æœåŒ…å«ç»“æ„åŒ–çš„å¤ç›˜å†…å®¹ï¼š

```markdown
---
type: weekly_review
create: 2026-01-08T10:30:00+08:00
group: å·ç¾¤-2025
week: 1
period_start: 2026-01-01
period_end: 2026-01-07
source: "wechat chatlog"
raw_note: '[[10_Sources/WeChat/00-raws/å·ç¾¤-2025/2026/01/ç¬¬1å‘¨/å·ç¾¤-2025 2026-01-01~2026-01-07-raw]]'
tags: [æŠ•èµ„, å¤ç›˜, AI, ...]
topics: [å¸‚åœºåˆ†æ, æŠ€æœ¯è¶‹åŠ¿, ...]
key_people: [ç‹å·, ...]
---

# å·ç¾¤-2025 ç¬¬1å‘¨ å‘¨æœŸçœ‹æ¿ï¼ˆ2026.01.01ï½2026.01.07ï¼‰

## Step2 Digestï¼šé«˜ä¿¡å·æ‘˜è¦
...

## Step3 è§‚ç‚¹å¡ç‰‡åº“
...

## Step7 æ´å¯Ÿåˆ¤æ–­
...
```

### ä¸ Obsidian çŸ¥è¯†åº“é›†æˆ

#### 1. Wikilink è‡ªåŠ¨å…³è”

Summary æ–‡ä»¶è‡ªåŠ¨åŒ…å«å¯¹ Raw æ–‡ä»¶çš„ wikilink å¼•ç”¨ï¼š

```markdown
raw_note: '[[10_Sources/WeChat/00-raws/å·ç¾¤-2025/2026/01/ç¬¬1å‘¨/å·ç¾¤-2025 2026-01-01~2026-01-07-raw]]'
```

ç‚¹å‡»å³å¯è·³è½¬åˆ°åŸå§‹èŠå¤©è®°å½•ã€‚

#### 2. ç›®å½•ç»“æ„

æŒ‰å¹´/æœˆ/å‘¨ç»„ç»‡ï¼Œä¾¿äºæ—¶é—´ç»´åº¦æ£€ç´¢ï¼š

```
10_Sources/WeChat/
â”œâ”€â”€ 00-raws/           # åŸå§‹è®°å½•
â”‚   â””â”€â”€ {ç¾¤å}/
â”‚       â””â”€â”€ {å¹´}/
â”‚           â””â”€â”€ {æœˆ}/
â”‚               â””â”€â”€ ç¬¬{å‘¨}å‘¨/
â””â”€â”€ 10-Summaries/      # åˆ†æç»“æœ
    â””â”€â”€ {ç¾¤å}/
        â””â”€â”€ {å¹´}/
            â””â”€â”€ {æœˆ}/
                â””â”€â”€ ç¬¬{å‘¨}å‘¨/
```

#### 3. Frontmatter å…ƒæ•°æ®

æ”¯æŒ Obsidian Dataview æŸ¥è¯¢ï¼š

```dataview
TABLE group, week, period_start, period_end
FROM "10_Sources/WeChat/10-Summaries"
WHERE type = "weekly_review"
SORT period_start DESC
```

#### 4. æœ¬åœ° Embedding

åˆ†æç»“æœä»¥ Markdown æ ¼å¼å­˜å‚¨ï¼Œå¯ç›´æ¥ç”¨äºï¼š
- Obsidian æœ¬åœ°æœç´¢
- ç¬¬ä¸‰æ–¹ embedding å·¥å…·ï¼ˆå¦‚ Ollama + RAGï¼‰
- æ„å»ºä¸ªäººçŸ¥è¯†å›¾è°±

### å‘½ä»¤è¡Œå‚æ•°

```bash
python -m rpa_llm.chatlog_automation --help
```

**ä¸»è¦å‚æ•°ï¼š**

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|:---|:---|:---|
| `--talker` | ç¾¤èŠæ ‡è¯†ï¼ˆå¿…å¡«ï¼‰ | `å·ç¾¤-2025` |
| `--start` | å¼€å§‹æ—¥æœŸ | `2026-01-01` |
| `--end` | ç»“æŸæ—¥æœŸ | `2026-01-07` |
| `--config` | é…ç½®æ–‡ä»¶è·¯å¾„ | `./chatlog_automation.yaml` |
| `--template` | åˆ†ææ¨¡æ¿è·¯å¾„ | `./templates/chatlog_for_wechat.md` |
| `--model-version` | æ¨¡å‹ç‰ˆæœ¬ | `5.2pro` |
| `--new-chat` | æ¯æ¬¡æ‰“å¼€æ–°çª—å£ | - |
| `--auto-mode` | è‡ªåŠ¨æ¨¡å¼ï¼ˆæ‰¹é‡å¤„ç†æ¨èï¼‰ | - |

### å‰ç½®ä¾èµ–

1. **Chatlog æœåŠ¡**ï¼šéœ€è¦å…ˆéƒ¨ç½²å¹¶è¿è¡Œ Chatlog æœåŠ¡
2. **Driver Server**ï¼šéœ€è¦å¯åŠ¨æœ¬é¡¹ç›®çš„ driver_server
3. **Obsidian Vault**ï¼šéœ€è¦æœ‰å¯å†™å…¥çš„ Obsidian vault ç›®å½•

```bash
# 1. å¯åŠ¨ Chatlog æœåŠ¡ï¼ˆå‚è€ƒ Chatlog é¡¹ç›®æ–‡æ¡£ï¼‰
# 2. å¯åŠ¨ Driver Server
python start_driver.py --brief ./brief.yaml
# 3. è¿è¡Œè‡ªåŠ¨åŒ–åˆ†æ
python -m rpa_llm.chatlog_automation --talker "ç¾¤å" --start 2026-01-01 --end 2026-01-07
```